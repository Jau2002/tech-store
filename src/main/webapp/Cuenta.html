<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>TechStore</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
			crossorigin="anonymous"
		/>
		<link rel="stylesheet" href="./css/register.css" />
		<script type="module" defer>
const $ = (select) => document.querySelector(select)

class IdIsChangePass {
	constructor() {
		this.submitButton = $('#submit')
		this.newPsw = $('#nPsw')
		this.conPsw = $('#cPsw')
		this.newPswError = $('#newPassHelpBlock')
		this.conPswError = $('#conPassHelpBlock')
		this.toBack = $('#toBack')
	}
}

const { newPsw, conPsw, newPswError, conPswError, submitButton, toBack } =
	new IdIsChangePass()

const passwordValidation = (pass, err) => {
	let isValid = true

	if (isValid != false && !pass.value) {
		pass.focus()
		isValid = false
		err.style.display = 'block'
	} else if (
		isValid != false &&
		!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d]{8,20}$/.test(pass.value)
	) {
		pass.focus()
		isValid = false
		err.style.display = 'block'
	} else {
		err.style.display = 'none'
	}
	return isValid
}

function validateIsChange() {
	let isValid = passwordValidation(newPsw, newPswError)

	if (isValid != false && !conPsw.value) {
		conPsw.focus()
		isValid = false
		conPswError.style.display = 'block'
	} else if (isValid != false && conPsw.value != newPsw.value) {
		conPsw.focus()
		isValid = false
		conPswError.style.display = 'block'
	} else {
		conPswError.style.display = 'none'
	}
	return isValid
}

const validations = {
	isChange: () => (submitButton.disabled = !validateIsChange()),
}

document.addEventListener('DOMContentLoaded', () => {
	newPsw.addEventListener('input', validations.isChange)
	conPsw.addEventListener('input', validations.isChange)

	submitButton.addEventListener('click', (event) => {
		event.preventDefault()
		if (validations.isChange()) {
			console.log('Formulario enviado')
		}
	})

	toBack.addEventListener('click', (_) => {
		window.history.back()
	})

	validations.isChange()
})
		</script>
	</head>
	<body>
		<main>
			<form method="post" action="index.html">
				<fieldset class="fieldset">
					<legend class="fieldset__legend">Cambiar contraseña</legend>
					<div class="mb-3">
						<input
							type="password"
							id="nPsw"
							placeholder="Ingrese nueva contraseña..."
							name="nPsw"
							class="form-control"
						/>
					</div>
					<p id="newPassHelpBlock" class="form-text">
						Tu contraseña debe tener entre 8 a 20 caracteres, al menos una
						mayúscula, una minúscula, un número, y que no incluya caracteres
						especiales ni espacios.
					</p>
					<div class="mb-3">
						<input
							id="cPsw"
							type="password"
							placeholder="Confirme nueva contraseña..."
							name="cPsw"
							class="form-control"
						/>
					</div>
					<p id="conPassHelpBlock" class="form-text">
						Tus contraseñas no coinciden
					</p>
					<button type="submit" id="submit" class="btn btn-outline-dark">
						Cambiar
					</button>
					<span type="button" class="fieldset__a" id="toBack">Volver</span>
				</fieldset>
			</form>
		</main>
	</body>
</html>
